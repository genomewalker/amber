<svg xmlns="http://www.w3.org/2000/svg" width="1150" height="320" viewBox="0 0 1150 320">
  <defs>
    <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M0,0 L10,5 L0,10 Z" fill="#64748B"/>
    </marker>
    <marker id="arrow-cyan" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M0,0 L10,5 L0,10 Z" fill="#0EA5E9"/>
    </marker>
    <marker id="arrow-blue" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M0,0 L10,5 L0,10 Z" fill="#3B82F6"/>
    </marker>
    <marker id="arrow-coral" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M0,0 L10,5 L0,10 Z" fill="#E46A5D"/>
    </marker>
    <filter id="shadow" x="-5%" y="-5%" width="110%" height="110%">
      <feDropShadow dx="0" dy="1" stdDeviation="1.5" flood-opacity="0.06"/>
    </filter>
  </defs>

  <rect width="1150" height="320" fill="#ffffff"/>

  <!-- ===== INPUTS ===== -->
  <g filter="url(#shadow)">
    <rect x="20" y="95" width="90" height="130" rx="8" fill="#F8FAFC" stroke="#E2E8F0" stroke-width="1.5"/>
    <text x="65" y="118" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="10" font-weight="600" fill="#334155">INPUTS</text>
    <line x1="30" y1="128" x2="100" y2="128" stroke="#E2E8F0" stroke-width="1"/>
    <text x="65" y="152" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="9" fill="#475569">Contigs</text>
    <text x="65" y="175" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="9" fill="#475569">BAM</text>
    <text x="65" y="198" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="9" fill="#475569">SCG</text>
  </g>

  <!-- ===== FEATURES ===== -->
  <g filter="url(#shadow)">
    <rect x="140" y="40" width="110" height="240" rx="8" fill="#F8FAFC" stroke="#E2E8F0" stroke-width="1.5"/>
    <text x="195" y="65" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="10" font-weight="600" fill="#334155">FEATURES</text>
    <line x1="150" y1="75" x2="240" y2="75" stroke="#E2E8F0" stroke-width="1"/>

    <!-- TNF - to encoder -->
    <rect x="150" y="85" width="90" height="35" rx="4" fill="#E0F2FE" stroke="#0EA5E9" stroke-width="1"/>
    <text x="195" y="102" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="9" font-weight="500" fill="#0369A1">TNF + cov</text>
    <text x="195" y="114" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="9" font-weight="600" fill="#0369A1">138d</text>

    <!-- SCG - to encoder (augment) -->
    <rect x="150" y="128" width="90" height="28" rx="4" fill="#DBEAFE" stroke="#3B82F6" stroke-width="1"/>
    <text x="195" y="146" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="9" font-weight="500" fill="#1D4ED8">SCG markers</text>

    <!-- aDNA - to encoder (weight) AND concat -->
    <rect x="150" y="164" width="90" height="45" rx="4" fill="#FEF2F2" stroke="#E46A5D" stroke-width="1.5"/>
    <text x="195" y="182" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="9" font-weight="600" fill="#E46A5D">aDNA damage</text>
    <text x="195" y="196" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="9" font-weight="600" fill="#E46A5D">20d</text>

    <!-- CGR - to concat -->
    <rect x="150" y="217" width="90" height="35" rx="4" fill="#F1F5F9" stroke="#94A3B8" stroke-width="1"/>
    <text x="195" y="234" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="9" font-weight="500" fill="#475569">CGR entropy</text>
    <text x="195" y="246" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="9" font-weight="600" fill="#475569">9d</text>
  </g>

  <!-- Input to Features arrow -->
  <path d="M110 160 L138 160" stroke="#64748B" stroke-width="1.5" fill="none" marker-end="url(#arrow)"/>

  <!-- ===== ENCODER ===== -->
  <g filter="url(#shadow)">
    <rect x="320" y="60" width="120" height="120" rx="8" fill="#F8FAFC" stroke="#E2E8F0" stroke-width="1.5"/>
    <text x="380" y="85" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="10" font-weight="600" fill="#334155">ENCODER</text>
    <line x1="330" y1="95" x2="430" y2="95" stroke="#E2E8F0" stroke-width="1"/>
    <text x="380" y="115" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="9" fill="#475569">Contrastive MLP</text>
    <text x="380" y="132" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="8" fill="#94A3B8">138d → 256 → 128d</text>
    <text x="380" y="150" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="8" fill="#94A3B8">InfoNCE loss</text>
    <text x="380" y="170" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="10" font-weight="600" fill="#334155">→ 128d</text>
  </g>

  <!-- TNF to Encoder (straight) -->
  <path d="M240 102 L318 102" stroke="#0EA5E9" stroke-width="1.5" fill="none" marker-end="url(#arrow-cyan)"/>
  <text x="279" y="94" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="8" fill="#0EA5E9">138d</text>

  <!-- SCG to Encoder (straight, dashed) -->
  <path d="M240 142 L318 142" stroke="#3B82F6" stroke-width="1.5" stroke-dasharray="4,2" fill="none" marker-end="url(#arrow-blue)"/>
  <text x="279" y="134" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="7" fill="#3B82F6">augment</text>

  <!-- aDNA to Encoder (smooth curve, dashed) -->
  <path d="M240 175 C270 175, 270 165, 318 165" stroke="#E46A5D" stroke-width="1.5" stroke-dasharray="4,2" fill="none" marker-end="url(#arrow-coral)"/>
  <text x="265" y="158" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="7" fill="#E46A5D">weight</text>

  <!-- ===== CONCAT ===== -->
  <g filter="url(#shadow)">
    <rect x="320" y="200" width="120" height="80" rx="8" fill="#F8FAFC" stroke="#374151" stroke-width="1.5"/>
    <text x="380" y="225" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="10" font-weight="600" fill="#334155">CONCAT</text>
    <text x="380" y="248" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="9" fill="#94A3B8">128 + 20 + 9</text>
    <text x="380" y="268" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="11" font-weight="700" fill="#334155">= 157d</text>
  </g>

  <!-- Encoder to Concat -->
  <path d="M380 180 L380 198" stroke="#64748B" stroke-width="1.5" fill="none" marker-end="url(#arrow)"/>

  <!-- aDNA to Concat (smooth curve) -->
  <path d="M240 195 C265 195, 265 225, 318 225" stroke="#E46A5D" stroke-width="1.5" fill="none" marker-end="url(#arrow-coral)"/>
  <text x="258" y="218" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="8" fill="#E46A5D">20d</text>

  <!-- CGR to Concat (smooth curve) -->
  <path d="M240 240 C280 240, 280 255, 318 255" stroke="#64748B" stroke-width="1.5" fill="none" marker-end="url(#arrow)"/>
  <text x="260" y="256" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="8" fill="#64748B">9d</text>

  <!-- ===== CLUSTERING ===== -->
  <g filter="url(#shadow)">
    <rect x="500" y="60" width="150" height="200" rx="8" fill="#F8FAFC" stroke="#E2E8F0" stroke-width="1.5"/>
    <text x="575" y="85" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="10" font-weight="600" fill="#334155">CLUSTERING</text>
    <line x1="510" y1="95" x2="640" y2="95" stroke="#E2E8F0" stroke-width="1"/>

    <!-- Step 1: k-NN -->
    <text x="575" y="115" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="9" fill="#475569">k-NN graph</text>

    <!-- Step 2: SCG edge penalty -->
    <rect x="515" y="125" width="120" height="18" rx="4" fill="#DBEAFE" stroke="#3B82F6" stroke-width="1"/>
    <text x="575" y="138" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="8" font-weight="500" fill="#1D4ED8">SCG edge penalty</text>

    <!-- Step 3: Leiden -->
    <rect x="515" y="150" width="120" height="18" rx="4" fill="#EDE9FE" stroke="#8B5CF6" stroke-width="1"/>
    <text x="575" y="163" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="8" font-weight="500" fill="#7C3AED">Leiden × 75</text>

    <!-- Step 4: Resolution sweep -->
    <text x="575" y="183" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="8" fill="#64748B">5 res × 5 seeds × 3 enc</text>

    <!-- Step 5: SCG quality scoring -->
    <rect x="515" y="192" width="120" height="18" rx="4" fill="#ECFDF5" stroke="#10B981" stroke-width="1"/>
    <text x="575" y="205" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="8" font-weight="500" fill="#059669">SCG quality score</text>

    <!-- Output -->
    <text x="575" y="240" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="10" font-weight="600" fill="#334155">→ 75 bin sets</text>
  </g>

  <!-- Concat to Clustering (right then up, rounded corner) -->
  <path d="M440 220 L455 220 Q470 220, 470 205 L470 175 Q470 160, 485 160 L498 160" stroke="#64748B" stroke-width="1.5" fill="none" marker-end="url(#arrow)"/>
  <text x="478" y="188" text-anchor="start" font-family="Inter, Helvetica, sans-serif" font-size="8" fill="#64748B">157d</text>

  <!-- ===== RESOLVE ===== -->
  <g filter="url(#shadow)">
    <rect x="720" y="60" width="130" height="200" rx="8" fill="#F8FAFC" stroke="#E2E8F0" stroke-width="1.5"/>
    <text x="785" y="85" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="10" font-weight="600" fill="#334155">RESOLVE</text>
    <line x1="730" y1="95" x2="840" y2="95" stroke="#E2E8F0" stroke-width="1"/>

    <!-- Step 1: Co-binning graph -->
    <text x="785" y="115" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="9" fill="#475569">Co-binning graph</text>

    <!-- Step 2: P_cobin filter -->
    <rect x="735" y="125" width="100" height="18" rx="4" fill="#FEF3C7" stroke="#F59E0B" stroke-width="1"/>
    <text x="785" y="138" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="8" font-weight="500" fill="#92400E">P_cobin ≥ 2/3</text>

    <!-- Step 3: SCG resolution sweep -->
    <rect x="735" y="150" width="100" height="18" rx="4" fill="#DBEAFE" stroke="#3B82F6" stroke-width="1"/>
    <text x="785" y="163" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="8" font-weight="500" fill="#1D4ED8">SCG res sweep</text>

    <!-- Step 4: Consensus -->
    <rect x="735" y="175" width="100" height="18" rx="4" fill="#ECFDF5" stroke="#10B981" stroke-width="1"/>
    <text x="785" y="188" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="8" font-weight="500" fill="#059669">Consensus Leiden</text>

    <!-- Step 5: Quality filter -->
    <text x="785" y="213" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="8" fill="#64748B">SCG quality filter</text>

    <!-- Output -->
    <text x="785" y="240" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="10" font-weight="600" fill="#334155">→ final bins</text>
  </g>

  <!-- Clustering to Resolve -->
  <path d="M650 160 L718 160" stroke="#64748B" stroke-width="1.5" fill="none" marker-end="url(#arrow)"/>

  <!-- ===== OUTPUT ===== -->
  <g filter="url(#shadow)">
    <rect x="920" y="60" width="200" height="200" rx="8" fill="#F8FAFC" stroke="#E2E8F0" stroke-width="1.5"/>
    <text x="1020" y="85" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="10" font-weight="600" fill="#334155">OUTPUT</text>
    <line x1="930" y1="95" x2="1110" y2="95" stroke="#E2E8F0" stroke-width="1"/>

    <rect x="935" y="105" width="170" height="50" rx="5" fill="#FEF3C7" stroke="#F59E0B" stroke-width="1.5"/>
    <text x="1020" y="128" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="11" font-weight="600" fill="#92400E">Genomic Bins</text>
    <text x="1020" y="145" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="9" fill="#A16207">FASTA per MAG</text>

    <rect x="935" y="163" width="170" height="40" rx="5" fill="#FEF2F2" stroke="#E46A5D" stroke-width="1"/>
    <text x="1020" y="183" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="10" font-weight="500" fill="#E46A5D">Bin damage profiles</text>
    <text x="1020" y="197" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="8" fill="#94A3B8">per-bin C→T, G→A</text>

    <rect x="935" y="211" width="170" height="40" rx="5" fill="#F1F5F9" stroke="#94A3B8" stroke-width="1"/>
    <text x="1020" y="231" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="10" fill="#475569">Quality metrics</text>
    <text x="1020" y="245" text-anchor="middle" font-family="Inter, Helvetica, sans-serif" font-size="8" fill="#94A3B8">completeness / contam</text>
  </g>

  <!-- Resolve to Output -->
  <path d="M850 160 L918 160" stroke="#64748B" stroke-width="1.5" fill="none" marker-end="url(#arrow)"/>

</svg>
